{% extends "base.html" %}
{% block title %}Dashboard - Financial Analysis{% endblock %}

{% block content %}
<div style="margin-bottom: 30px;">
    <a href="/" class="btn">‚Üê Back to Upload</a>
</div>

<div id="charts-container">
    {% for chart in charts %}
    <div class="chart-container">
        <h3 class="chart-title">{{ chart.config.title }}</h3>
        <p class="chart-description">{{ chart.config.description }}</p>
        <div id="chart-{{ loop.index0 }}" style="height: 400px;"></div>
        <div class="chart-insight">
            üí° <strong>Insight:</strong> {{ chart.config.insight }}
        </div>
    </div>
    {% endfor %}
</div>

{% if forecast_chart %}
<div class="chart-container">
    <h3 class="chart-title">üìà Revenue Forecast</h3>
    <p class="chart-description">AI-powered forecast using Prophet time series analysis</p>
    <div id="forecast-chart" style="height: 400px;"></div>
    <div class="chart-insight">
        üí° <strong>Forecast Insight:</strong> This projection shows expected revenue trends based on historical data. Use this to plan inventory, staffing, and cash flow.
    </div>
</div>
{% endif %}

<script type="application/json" id="dashboard-data">
{
  "charts": {{ charts | tojson | safe }},
  "forecastChart": {{ forecast_chart | tojson | safe if forecast_chart else 'null' }}
}
</script>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const parsed = JSON.parse(document.getElementById("dashboard-data").textContent);

    // Render each chart
    parsed.charts.forEach((item, index) => {
        const div = document.getElementById("chart-" + index);
        if (div && item.chart) {
            const fig = JSON.parse(item.chart);
            Plotly.newPlot(div, fig.data, fig.layout || {}, { responsive: true });
        }
    });

    // Forecast chart
    if (parsed.forecastChart) {
        const fig = JSON.parse(parsed.forecastChart);
        Plotly.newPlot("forecast-chart", fig.data, fig.layout || {}, { responsive: true });
    }

    // Hide loading screen
    const loader = document.getElementById("loading-screen");
    if (loader) loader.style.display = "none";
});
</script>
{% endblock %}
